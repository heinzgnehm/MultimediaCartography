<!DOCTYPE HTML>
<html>
	<head>

		<!-- Remote stylesheets -->
		<link href='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.css' rel='stylesheet' />
		<link href="libs/font-awesome-4.6.1/css/font-awesome.min.css" rel="stylesheet" type="text/css">
		<!--<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css"/> -->

		<!-- Local stylesheets -->
		<link rel="stylesheet" type="text/css" href="libs/leaflet-0.7.7/leaflet.css"/>
		<!--<link rel="stylesheet" type="text/css" href="styles/chicago.css"/>-->
		<link rel="stylesheet" type="text/css" href="styles/Atlas.css"/>
		<link rel="stylesheet" type="text/css" href="libs/jquery-ui-1.11.4/jquery-ui.css">
		<link rel="stylesheet" type="text/css" href="libs/jstree-3.2.1/themes/default/style.min.css">
		<link rel="stylesheet" type="text/css" href="libs/noUiSlider-8.3.0/nouislider.css">
		<link rel="stylesheet" type="text/css" href="libs/noUiSlider-8.3.0/nouislider.pips.css">

		<!-- Remote libraries -->
		<script src='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.js'></script>
		<!--<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script> -->
		<!-- <script type="text/javascript" src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script> -->
		<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/jstree.min.js"></script> -->

		<!-- Local libraries -->
		<!--<script type="text/javascript" src="libs/leaflet-0.7.7/leaflet.js"></script>-->
		<!--<script type="text/javascript" src="libs/jquery-2.2.3/jquery-2.2.3.min.js"></script>-->
		<script type="text/javascript" src="libs/jquery-ui-1.11.4/external/jquery/jquery.js"></script>
		<script type="text/javascript" src="libs/jquery-ui-1.11.4/jquery-ui.js"></script>
		<script type="text/javascript" src="libs/jstree-3.2.1/jstree.min.js"></script>
		<script type="text/javascript" src="libs/noUiSlider-8.3.0/nouislider.js"></script>

	</head>
	<body>

		<!-- DIV element to show the menu bar at the top. -->
		<div class="menubar ns">
		  <span id="title">Chicago - Exploring crime, ethnicity and socio-economic indicators</span>
		  <button id="imprint">Imprint</button>
		  <button id="about">About</button>
		  <button id="fullscreen">Full Screen</button>
		  <input id="search" placeholder="Search-place">
		  <div id="search-results"></div>
		</div>

		<!-- DIV element to display the menu on the left side. -->

		<div class="navigation ns">

			<div id="tabs">
  				<button id="collapse-left" class="ui-btn ui-shadow ui-corner-all  ">Collapse left</button>
  				<ul>
    					<li><a href="#tabs-1">Layers</a></li>
  				</ul>
  			<div id="tabs-1">
  			<input id="search-layer" placeholder="Search layer">
			<div id="layers-tree"></div>
			<div  id="jstree-button-tab"></div>
  			</div>
			</div>
		</div>

		<!-- DIV element to display the collapsed menu on the left side. -->
		<div class="collapsed-navigation">
			<button id="collapse-right" class="ui-btn ui-shadow ui-corner-all">Show</button>
		</div>

		<!-- DIV element to display dialog windows. -->
		<div id="dialog" title="Information">
			<iframe id="dialogframe" frameborder="0"></iframe>
		</div>
		<!-- DIV element to display bar graph -->
		<div id="bar-graph" title="Bar Graph">
			<iframe id="bar-graph-frame" frameborder="0"></iframe>
		</div>

		<!-- DIV element to display the leaflet map. -->
		<div id="map" class="map"></id>

		<!-- DIV element to display the time slider. -->
		<div class="slider-container">
			<div id="slider"></div>
		</div>
		<!-- button element for home button -->
		<button id="home-map" class="home-map" >
			<!--<i class="fa fa-dot-circle-o fa-1.5x" aria-hidden="true"></i>-->
		</button> <!--class="ui-btn ui-shadow ui-corner-all"-->

	</body>
	<script src="scripts/metadata.js"></script>
	<script src="scripts/social.js"></script>
	<script src="scripts/crime.js"></script>
	<script src="scripts/ethnicity.js"></script>
	<script>

			/*
				Set the initial map view.
			*/
			var southWest = L.latLng(42.363436, -88.6074225),
                   	    northEast = L.latLng(41.272109, -87),
                            chicagoBounds = L.latLngBounds(southWest, northEast);
                    	L.mapbox.accessToken = 'pk.eyJ1IjoiaGVpbnpnbmVobSIsImEiOiJjaWxmYnh0M2gwMDM3dmtrcWJqdXNrcHJ2In0.LPk9jEhxzI76y48cFQLHcA';
			var map = L.mapbox.map('map','heinzgnehm.1llnqpli', {zoomControl: false,
						       maxBounds: chicagoBounds,
    						       maxZoom: 16,
   						       minZoom: 10}).setView([41.8369, -87.6847], 11);
			map.addControl(L.control.zoom({position: 'bottomleft'}));

			/*
				Load OpenStreeMap data from Mapbox.
			*/
			/**
			L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
				attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery &copy; <a href="http://mapbox.com">Mapbox</a>',
				maxZoom: 12,
				id: 'heinzgnehm.1llnqpli',
				accessToken: 'pk.eyJ1IjoiaGVpbnpnbmVobSIsImEiOiJjaWxmYnh0M2gwMDM3dmtrcWJqdXNrcHJ2In0.LPk9jEhxzI76y48cFQLHcA'
			}).addTo(map);
			**/
			/*
				Add geocoder
			*/
			var geocoderControl = L.mapbox.geocoderControl('mapbox.places');
			/*
				Global variables for the data set layer, the legend and the info box.
			*/
			var chosenDataSet;
			var layer;
			var legend;
			var info;

			/*
				Show the selected data set on the base map.
			*/
			function showDataSet(data, name) {

				switch(data) {
					case 'social': chosenDataSet = chicago_social; break;
					case 'crime': chosenDataSet = chicago_crime; break;
					case 'ethnicity': chosenDataSet = chicago_ethnicity; break;
				}

				chosenDataSet.init(name);
				showDataLayer(chosenDataSet);
				showLegend(chosenDataSet);
				showInfo(chosenDataSet);
			}

			/*
				Show the selected year set on the base map.
			*/
			function showYear(year) {

				chosenDataSet.setYear(year);
				showDataLayer(chosenDataSet);
				showLegend(chosenDataSet);
				showInfo(chosenDataSet);
			}

			/*
				Display the data set layer on the map.
			*/
			function showDataLayer(dataSet) {
				if (map.hasLayer(layer)) {
					map.removeLayer(layer);
				}
				layer = L.geoJson(dataSet.getDataSet(), {
					style: style,
					onEachFeature: onEachFeature
				}).addTo(map);
			}

			/*
				Display the legend on the map.
			*/
			function showLegend(dataSet) {
				if (legend != undefined) {
					legend.removeFrom(map);
				}
				legend = L.control({position: 'bottomright'});
				legend.onAdd = function(map) {
					return dataSet.getDiv();
				};
				legend.addTo(map);
			}

			/*
				Display the info box on the map.
			*/
			function showInfo(dataSet) {
				if (info != undefined) {
					info.removeFrom(map);
				}

				info = L.control();
				info.onAdd = function (map) {
					this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
					this.update();
					return this._div;
				};

				// method that we will use to update the control based on feature properties passed
				info.update = function (props) {
					this._div.innerHTML = '<h4>' + dataSet.title + '</h4>' +  (props ?
						'<b>' + props.community + '</b><br />' + props[dataSet.name].toFixed() + " " + dataSet.unit
						: 'Hover over a community');
				};
				info.addTo(map);
			}

			function style(feature) {
				return {
					fillColor: chosenDataSet.getColor(feature.properties[chosenDataSet.name]),
					weight: 2,
					opacity: 1,
					color: 'white',
					dashArray: '3',
					fillOpacity: 0.7
				};
			}

			function highlightFeature(e) {
				var layer = e.target;
				layer.setStyle({
					weight: 5,
					color: '#666',
					dashArray: '',
					fillOpacity: 0.7
				});

				if (!L.Browser.ie && !L.Browser.opera) {
					layer.bringToFront();
				}
				if (info != undefined) {
					info.update(layer.feature.properties);
				}
			}

			function resetHighlight(e) {
				layer.resetStyle(e.target);
				if (info != undefined) {
					info.update();
				}
			}

			function zoomToFeature(e) {
				map.fitBounds(e.target.getBounds());
			}

			function onEachFeature(feature, layer) {
				layer.on({
					mouseover: highlightFeature,
					mouseout: resetHighlight,
					click: zoomToFeature
				});
			}

		</script>
	<script src="scripts/gui.js"></script>
</html>
